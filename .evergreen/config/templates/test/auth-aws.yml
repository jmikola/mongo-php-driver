tasks:
  - name: "auth-aws-assume_role_with_web_identity-with_role_session_name-%mongodbVersion%"
    tags: ["auth-aws", "%mongodbVersion%"]
    commands:
      - func: "bootstrap mongo-orchestration"
        vars:
          MONGODB_VERSION: "%mongodbVersion%"
          TOPOLOGY: "server"
          ORCHESTRATION_FILE: "auth-aws.json"
      - func: "get aws auth secrets"
      - func: "run aws auth test"
        vars:
          AWS_AUTH_TEST: "web-identity"
          AWS_ROLE_SESSION_NAME: "test"

  - name: "auth-aws-assume_role_with_web_identity-without_role_session_name-%mongodbVersion%"
    tags: ["auth-aws", "%mongodbVersion%"]
    commands:
      - func: "bootstrap mongo-orchestration"
        vars:
          MONGODB_VERSION: "%mongodbVersion%"
          TOPOLOGY: "server"
          ORCHESTRATION_FILE: "auth-aws.json"
      - func: "get aws auth secrets"
      - func: "run aws auth test"
        vars:
          AWS_AUTH_TEST: "web-identity"
          AWS_ROLE_SESSION_NAME: ""
